@page
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@model ServerApp.Pages.ShowPlayersByModel
@{
    ViewData["Title"] = "All Players";
}

<div class="max-w-5xl mx-auto mt-12 mb-16 px-4">
    <h2 class="text-3xl font-bold text-indigo-700 mb-4">All Registered Players</h2>

    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-3">
        <!-- Sort -->
        <div>
            <span class="text-gray-600 mr-2">Sort by name:</span>
            <a asp-page="/ShowPlayersBy" asp-route-sortOrder="asc"
               class="text-indigo-600 hover:underline font-semibold">Ascending</a>
            <span class="text-gray-400 px-1">|</span>
            <a asp-page="/ShowPlayersBy" asp-route-sortOrder="desc"
               class="text-indigo-600 hover:underline font-semibold">Descending</a>
        </div>
        <!-- Player Select -->
        <form method="get" class="flex items-center gap-2">
            <label for="selectedPlayerId" class="text-gray-600">View games for:</label>
            <select id="selectedPlayerId" name="selectedPlayerId"
                    class="rounded-xl border-gray-300 px-4 py-2 bg-white shadow focus:ring-indigo-400 focus:border-indigo-400"
                    onchange="this.form.submit()">
                <option value="">-- Select Player --</option>
                @foreach (var player in Model.Players)
                {
                    if (player.Id == Model.SelectedPlayerId)
                    {
                        <option value="@player.Id" selected> @player.FirstName </option>
                    }
                    else
                    {
                        <option value="@player.Id"> @player.FirstName </option>
                    }
                }
            </select>
            <input type="hidden" name="sortOrder" value="@Model.SortOrder" />
        </form>
    </div>

    <!-- 17. All Players Table: Full Details -->
    <section class="mb-8">
        <h3 class="text-2xl font-bold text-indigo-700 mb-2">All Players (Full Details)</h3>
        <div class="overflow-x-auto rounded-2xl shadow">
            <table class="min-w-full bg-white">
                <thead>
                    <tr class="bg-indigo-100 text-indigo-800 text-left">
                        <th class="py-3 px-5 font-semibold">Name</th>
                        <th class="py-3 px-5 font-semibold">ID</th>
                        <th class="py-3 px-5 font-semibold">Phone</th>
                        <th class="py-3 px-5 font-semibold">Country</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var player in Model.Players)
                    {
                        <tr class="even:bg-indigo-50 hover:bg-indigo-100">
                            <td class="py-2 px-5">@player.FirstName</td>
                            <td class="py-2 px-5">@player.Id</td>
                            <td class="py-2 px-5">@player.Phone</td>
                            <td class="py-2 px-5">@player.Country</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </section>

    <!-- 18. Player Names Only (Always Descending) -->
    <section class="mb-8">
        <h3 class="text-2xl font-bold text-indigo-700 mb-2">Player Names (Descending)</h3>
        <ul class="list-disc list-inside">
            @foreach (var player in Model.Players
                        .OrderByDescending(p => p.FirstName,
                        Comparer<string>.Create((a, b) => a.CompareTo(b))))
            {
                <li>@player.FirstName</li>
            }
        </ul>
    </section>

    <!-- 22. Players Ranked by Number of Games -->
    <section class="mb-8">
        <h3 class="text-2xl font-bold text-indigo-700 mb-2">Players Ranked by Number of Games</h3>
        <div class="overflow-x-auto rounded-2xl shadow">
            <table class="min-w-full bg-white">
                <thead>
                    <tr class="bg-orange-100 text-orange-800 text-left">
                        <th class="py-3 px-5 font-semibold">Player</th>
                        <th class="py-3 px-5 font-semibold">Number of Games</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.PlayersWithGameCount)
                    {
                        <tr class="even:bg-orange-50 hover:bg-orange-100">
                            <td class="py-2 px-5">@item.PlayerName</td>
                            <td class="py-2 px-5">@item.GameCount</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </section>

    <!-- 24. Players Grouped by Country -->
    <section class="mb-8">
        <h3 class="text-2xl font-bold text-indigo-700 mb-2">Players Grouped by Country</h3>
        <div class="overflow-x-auto rounded-2xl shadow">
            <table class="min-w-full bg-white">
                <thead>
                    <tr class="bg-pink-100 text-pink-800 text-left">
                        <th class="py-3 px-5 font-semibold">Country</th>
                        <th class="py-3 px-5 font-semibold">Number of Players</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.PlayersPerCountry)
                    {
                        <tr class="even:bg-pink-50 hover:bg-pink-100">
                            <td class="py-2 px-5">@item.Country</td>
                            <td class="py-2 px-5">@item.Count</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </section>

    <!-- 21 & 19. Selected Player's Games -->
    @if (Model.SelectedPlayer != null)
    {
        <section class="mb-8">
            <h3 class="text-2xl font-bold text-indigo-700 mb-2">Games for @Model.SelectedPlayer.FirstName</h3>
            <div class="overflow-x-auto rounded-2xl shadow">
                <table class="min-w-full bg-white">
                    <thead>
                        <tr class="bg-violet-100 text-violet-800 text-left">
                            <th class="py-3 px-5 font-semibold">Game ID</th>
                            <th class="py-3 px-5 font-semibold">Start Time</th>
                            <th class="py-3 px-5 font-semibold">Duration</th>
                            <th class="py-3 px-5 font-semibold">Winner</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var game in Model.Games)
                        {
                            <tr class="even:bg-violet-50 hover:bg-violet-100">
                                <td class="py-2 px-5">@game.Id</td>
                                <td class="py-2 px-5">@(game.StartTime.AddHours(3).ToString("dd/MM/yyyy HH:mm:ss"))</td>
                                <td class="py-2 px-5">@game.Duration.ToString(@"mm\:ss\.fff")</td>
                                <td class="py-2 px-5">@game.Winner</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </section>
    }
    <section class="mb-8">
        <h3 class="text-2xl font-bold text-indigo-700 mb-2">All Games (Distinct)</h3>
        <div class="overflow-x-auto rounded-2xl shadow">
            <table class="min-w-full bg-white">
                <thead>
                    <tr class="bg-gray-100 text-gray-800 text-left">
                        <th class="py-3 px-5 font-semibold">Game ID</th>
                        <th class="py-3 px-5 font-semibold">Player ID</th>
                        <th class="py-3 px-5 font-semibold">Start Time</th>
                        <th class="py-3 px-5 font-semibold">Duration</th>
                        <th class="py-3 px-5 font-semibold">Winner</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var game in Model.AllGames)
                    {
                        <tr class="even:bg-gray-50 hover:bg-gray-100">
                            <td class="py-2 px-5">@game.Id</td>
                            <td class="py-2 px-5">@game.PlayerId</td>
                            <td class="py-2 px-5">@(game.StartTime.AddHours(3).ToString("dd/MM/yyyy HH:mm:ss"))</td>
                            <td class="py-2 px-5">@game.Duration.ToString(@"mm\:ss\.fff")</td>
                            <td class="py-2 px-5">@game.Winner</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </section>
    <!-- Optional: Last Game Info (beyond 17–24) -->
    @if (Model.PlayersWithLastGame.Any())
    {
        <section class="mb-8">
            <h3 class="text-2xl font-bold text-indigo-700 mb-2">Players with Last Game Info</h3>
            <div class="overflow-x-auto rounded-2xl shadow">
                <table class="min-w-full bg-white">
                    <thead>
                        <tr class="bg-emerald-100 text-emerald-800 text-left">
                            <th class="py-3 px-5 font-semibold">Player</th>
                            <th class="py-3 px-5 font-semibold">
                                Last Game
                                Time
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.PlayersWithLastGame)
                        {
                            <tr class="even:bg-emerald-50 hover:bg-emerald-100">
                                <td class="py-2 px-5">@item.PlayerName</td>
                                <td class="py-2 px-5">
                                    @(item.LastGame != null ? item.LastGame.Value.AddHours(3).ToString("dd/MM/yyyy HH:mm:ss") : "No games")
                        </td>
                    </tr>
                                        }
                    </tbody>
                </table>
            </div>
        </section>
    }
</div>
